# Production MCP Gateway Configuration
env: "prod"

# OIDC Configuration
oidc:
  issuer: "https://auth.astradesk.com"
  audience: "mcp-gateway"
  jwks_url: "https://auth.astradesk.com/.well-known/jwks.json"
  token_lifetime_seconds: 3600
  refresh_token_lifetime_seconds: 86400

# Rate Limiting
rate_limits:
  default_rpm: 600
  burst_multiplier: 2
  per_tool:
    "jira.create_issue": 100
    "kb.search": 1000
    "slack.post_message": 300
  per_client:
    default: 1000
    premium: 5000

# Circuit Breaker Settings
circuit_breakers:
  default:
    failure_threshold: 50
    recovery_timeout: 30
    half_open_requests: 3
  per_tool:
    "jira.create_issue":
      failure_threshold: 30
      recovery_timeout: 60

# Redis Configuration
redis:
  cluster_mode: true
  nodes:
    - host: "redis-0.redis"
      port: 6379
    - host: "redis-1.redis"
      port: 6379
    - host: "redis-2.redis"
      port: 6379
  pool_size: 100
  retry_attempts: 3
  timeout_ms: 1000

# Caching
cache:
  enabled: true
  default_ttl: 300
  max_size_mb: 1024
  per_tool:
    "kb.search": 600
    "jira.get_issue": 120

# Tool Configuration
tools:
  - name: "kb.search"
    mcp_endpoint: "http://kb-service:8000"
    side_effect: "read"
    schema_ref: "sha256:abc123"
    timeout_ms: 5000
    retry:
      max_attempts: 3
      backoff_ms: 1000
    
  - name: "jira.create_issue"
    mcp_endpoint: "http://jira-service:8000"
    side_effect: "write"
    schema_ref: "sha256:def456"
    timeout_ms: 10000
    retry:
      max_attempts: 2
      backoff_ms: 2000

# Audit Configuration
audit:
  sink: "redis://redis:6379/1"
  hash_algo: "sha256"
  retention_days: 365
  batch_size: 100
  flush_interval_ms: 1000
  detailed_logging: true

# Monitoring
monitoring:
  metrics:
    prometheus_endpoint: "/metrics"
    collection_interval_ms: 10000
  tracing:
    enabled: true
    exporter: "jaeger"
    endpoint: "http://jaeger:14268/api/traces"
    sampling_ratio: 0.1
  health:
    enabled: true
    detailed: true
    includes: ["redis", "tools", "cache"]

# Security
security:
  request_signing:
    enabled: true
    algorithm: "ed25519"
    key_rotation_hours: 24
  response_signing:
    enabled: true
    algorithm: "ed25519"
  tls:
    min_version: "1.3"
    cert_path: "/etc/certs/tls.crt"
    key_path: "/etc/certs/tls.key"
  headers:
    security_headers: true
    cors:
      allowed_origins: ["https://*.astradesk.com"]
      allowed_methods: ["POST", "GET", "OPTIONS"]

# High Availability
ha:
  leader_election:
    enabled: true
    lease_duration_seconds: 15
  load_balancing:
    strategy: "least_connections"
    health_check_interval_ms: 5000