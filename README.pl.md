<p align="center">
  <img src="docs/assets/AstraDesktop.png" alt="AstraDesk - Enterprise AI Framework" width="560"/>
</p>

<br>

# AstraDesk - Enterprise AI Framework

[![License](https://img.shields.io/badge/License-Apache%202.0-yellow.svg)](https://www.apache.org/licenses/LICENSE-2.0)
[![Python Version](https://img.shields.io/badge/Python-3.11-blue.svg)](https://www.python.org/downloads/release/python-3110/)
[![JDK Version](https://img.shields.io/badge/JDK-21-green.svg)](https://openjdk.org/projects/jdk/21/)
[![Node.js Version](https://img.shields.io/badge/Node.js-22-brightgreen.svg)](https://nodejs.org/en)
[![Build Status](https://img.shields.io/badge/Build-Passing-brightgreen.svg)](https://github.com/your-org/astradesk/actions)


üåç **Jƒôzyki:** [English](README.md) | üáµüá± [Polski](README.pl.md) |  [‰∏≠Êñá (ÂΩìÂâçÊñá‰ª∂)](README.zh-CN.md)

<br>

[AstraDesk](https://astradesk.vercel.app/)
 to wewnƒôtrzny framework do budowy agent√≥w AI, zaprojektowany dla dzia≈Ç√≥w wsparcia (Support) i operacji (SRE/DevOps). Oferuje modularnƒÖ architekturƒô z gotowymi agentami demonstracyjnymi, integracjami z bazami danych, systemami messagingu i narzƒôdziami DevOps. Framework wspiera skalowalno≈õƒá, bezpiecze≈Ñstwo enterprise (OIDC/JWT, RBAC, mTLS via Istio) oraz pe≈Çne CI/CD.

## Spis tre≈õci

- [Funkcje](#funkcje)
- [Przeznaczenie i Zastosowania](#przeznaczenie-i-zastosowania)
- [PrzeglƒÖd architektury](#przeglƒÖd-architektury)
- [Wymagania wstƒôpne](#wymagania-wstƒôpne)
- [Instalacja](#instalacja)
  - [Lokalne ≈õrodowisko (Docker Compose)](#lokalne-≈õrodowisko-docker-compose)
  - [Budowanie ze ≈∫r√≥de≈Ç](#budowanie-ze-≈∫r√≥de≈Ç)
- [Konfiguracja](#konfiguracja)
  - [Zmienne ≈õrodowiskowe](#zmienne-≈õrodowiskowe)
  - [Uwierzytelnianie OIDC/JWT](#uwierzytelnianie-oidcjwt)
  - [Polityki RBAC](#polityki-rbac)
- [U≈ºycie](#u≈ºycie)
  - [Uruchamianie agent√≥w](#uruchamianie-agent√≥w)
  - [Wczytywanie dokument√≥w do RAG](#wczytywanie-dokument√≥w-do-rag)
  - [Portal administracyjny](#portal-administracyjny)
  - [Narzƒôdzia i integracje](#narzƒôdzia-i-integracje)
- [Wdro≈ºenie](#wdro≈ºenie)
  - [Kubernetes (Helm)](#kubernetes-helm)
  - [OpenShift](#openshift)
  - [AWS (Terraform)](#aws-terraform)
  - [Narzƒôdzia zarzƒÖdzania konfiguracjƒÖ](#narzƒôdzia-zarzƒÖdzania-konfiguracjƒÖ)
  - [mTLS i siatka us≈Çug Istio](#mtls-i-siatka-us≈Çug-istio)
- [CI/CD](#cicd)
  - [Jenkins](#jenkins)
  - [GitLab CI](#gitlab-ci)
- [Monitorowanie i obserwowalno≈õƒá](#monitorowanie-i-obserwowalno≈õƒá)
  - [OpenTelemetry](#opentelemetry)
  - [Pulpity i alerty Grafany](#pulpity-i-alerty-grafany)
- [Przewodnik dla deweloper√≥w](#przewodnik-dla-deweloper√≥w)
- [Testowanie](#testowanie)
- [Bezpiecze≈Ñstwo](#bezpiecze≈Ñstwo)
- [Mapa drogowa](#mapa-drogowa)
- [Wk≈Çad](#wk≈Çad)
- [Licencja](#licencja)
- [Kontakt](#kontakt)

## Funkcje

- **AI Agents**: Dwa gotowe agenty:
  - **SupportAgent**: Wsparcie u≈ºytkownika z RAG na dokumentach firmowych (PDF, HTML, Markdown), pamiƒôciƒÖ dialogowƒÖ i narzƒôdziami ticketingu.
  - **OpsAgent**: Automatyzacje SRE/DevOps ‚Äì pobieranie metryk (z Prometheus/Grafana), akcje operacyjne (np. restart us≈Çugi) z politykami i audytem.
- **Modular Core**: Python-based framework z registry tooli, plannerem, pamiƒôciƒÖ (Redis/Postgres), RAG (pgvector) i eventami (NATS).
- **Integrations**:
  - Java Ticket Adapter (Spring Boot WebFlux + MySQL) dla korporacyjnych system√≥w ticketingu.
  - Next.js Admin Portal do monitoringu agent√≥w, audyt√≥w i test√≥w prompt√≥w.
- **Security**: OIDC/JWT auth, RBAC per tool, mTLS via Istio, audyt dzia≈Ça≈Ñ.
- **DevOps Ready**: Docker, Kubernetes (Helm), OpenShift, Terraform (AWS), Ansible/Puppet/Salt, CI/CD (Jenkins/GitLab).
- **Observability**: OpenTelemetry, Prometheus/Grafana/Loki/Tempo.
- **Scalability**: HPA w Helm, retries/timeouty w integracjach, autoscaling w EKS.

## Przeznaczenie i Zastosowania

**AstraDesk** to **framework do budowy agent√≥w AI** dla zespo≈Ç√≥w **Support** oraz **SRE/DevOps**.
Zapewnia modu≈Çowy rdze≈Ñ (planer, pamiƒôƒá, RAG, rejestr narzƒôdzi) i gotowe agentowe przyk≈Çady.

- **Support / Helpdesk**: RAG na dokumentach firmy (procedury, FAQ, runbooki), tworzenie/aktualizacja zg≈Çosze≈Ñ (tickety), pamiƒôƒá konwersacji.
- **Automatyzacje SRE/DevOps**: odczyt metryk (Prometheus/Grafana), triage incydent√≥w, kontrolowane akcje (np. restart us≈Çugi) zabezpieczone **RBAC** i objƒôte audytem.
- **Integracje enterprise**: Gateway (Python/FastAPI), Adapter Ticket√≥w (Java/WebFlux + MySQL), Portal Admin (Next.js) oraz warstwa danych (Postgres/pgvector, Redis, NATS).
- **Bezpiecze≈Ñstwo i compliance**: OIDC/JWT, RBAC per‚Äënarzƒôdzie, **mTLS** (Istio), pe≈Çen ≈õlad audytowy.
- **Operacje na skalƒô**: Docker/Kubernetes/OpenShift, Terraform (AWS), CI/CD (Jenkins/GitLab), obserwowalno≈õƒá (OpenTelemetry, Prometheus/Grafana/Loki/Tempo).

> **To nie pojedynczy chatbot**, lecz **framework** do komponowania w≈Çasnych agent√≥w, narzƒôdzi i polityk z pe≈ÇnƒÖ kontrolƒÖ (bez lock‚Äëin do SaaS).

## PrzeglƒÖd architektury

AstraDesk sk≈Çada siƒô z trzech g≈Ç√≥wnych komponent√≥w:
- **Python API Gateway**: FastAPI obs≈ÇugujƒÖcy ≈ºƒÖdania do agent√≥w, z RAG, pamiƒôciƒÖ i toolami.
- **Java Ticket Adapter**: Reaktywny serwis (WebFlux) integrujƒÖcy z MySQL dla ticketingu.
- **Next.js Admin Portal**: Interfejs webowy do monitoringu.

Komunikacja: HTTP (miƒôdzy komponentami), NATS (eventy/audyty), Redis (pamiƒôƒá robocza), Postgres/pgvector (RAG/dialogi/audyty), MySQL (tickety).

## Wymagania wstƒôpne

- **Docker** i **Docker Compose** (do lokalnego dev).
- **Kubernetes** z Helm (do deploymentu).
- **AWS CLI** i **Terraform** (do chmury).
- **Node.js 22**, **JDK 21**, **Python 3.11** (do build√≥w).
- **Postgres 17**, **MySQL 8**, **Redis 7**, **NATS 2** (serwisy bazowe).
- **Opcjonalnie:** Istio, cert-manager (do mTLS/TLS).

## Instalacja

### Lokalne ≈õrodowisko (Docker Compose)

1. Sklonuj repozytorium:
   ```
   git clone https://github.com/your-org/astradesk.git
   cd astradesk
   ```

2. Skopiuj przyk≈ÇadowƒÖ konfiguracjƒô:
   ```
   cp .env.example .env
   ```
   - Edytuj `.env` (np. DATABASE_URL, OIDC_ISSUER).

3. Zbuduj i uruchom:
   ```
   make up
   ```
   - To uruchomi: API (8080), Ticket Adapter (8081), Admin Portal (3000), bazy i serwisy.

4. Zainicjuj bazƒô Postgres (pgvector):
   ```
   make migrate
   ```

5. Wrzuƒá dokumenty do `./docs` (np. .md, .txt) i zainicjuj RAG:
   ```
   make ingest
   ```

6. Sprawd≈∫ health:
   ```
   curl http://localhost:8080/healthz
   ```
   - Admin Portal: http://localhost:3000

### Budowanie ze ≈∫r√≥de≈Ç

1. Zainstaluj zale≈ºno≈õci:
   ```
   make sync  # Python
   make build-java  # Java
   make build-admin  # Next.js
   ```

2. Uruchom lokalnie (bez Docker):
   - Python API: `uv run uvicorn gateway.main:app --host 0.0.0.0 --port 8080 --reload`
   - Java Adapter: `cd services/ticket-adapter-java && ./gradlew bootRun`
   - Admin Portal: `cd services/admin-portal && npm run dev`

## Konfiguracja

### Zmienne ≈õrodowiskowe

- **DATABASE_URL**: PostgreSQL connection string (np. `postgresql://user:pass@host:5432/db`).
- **REDIS_URL**: Redis URI (np. `redis://host:6379/0`).
- **NATS_URL**: NATS server (np. `nats://host:4222`).
- **TICKETS_BASE_URL**: URL do Java adaptera (np. `http://ticket-adapter:8081`).
- **MYSQL_URL**: MySQL JDBC (np. `jdbc:mysql://host:3306/db?useSSL=false`).
- **OIDC_ISSUER**: Issuer OIDC (np. `https://your-issuer.com/`).
- **OIDC_AUDIENCE**: Audience JWT.
- **OIDC_JWKS_URL**: URL do JWKS (np. `https://your-issuer.com/.well-known/jwks.json`).

Pe≈Çna lista w `.env.example`.

### Uwierzytelnianie OIDC/JWT

- W≈ÇƒÖczone w API Gateway i Java Adapter.
- U≈ºyj Bearer token w requestach: `Authorization: Bearer <token>`.
- Walidacja: Issuer, audience, signature via JWKS.
- W Admin Portal: U≈ºyj Auth0 lub podobnego do front-channel flow.

### Polityki RBAC

- Role z JWT claims (np. "roles": ["sre"]).
- Narzƒôdzia (np. restart_service) sprawdzajƒÖ role via `require_role(claims, "sre")`.
- Dostosuj w `runtime/policy.py` i toolach (np. `REQUIRED_ROLE_RESTART`).

## U≈ºycie

### Uruchamianie agent√≥w

Wywo≈Çaj API:

```sh
curl -X POST http://localhost:8080/v1/agents/run \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your-jwt-token>" \
  -d '{"agent": "support", "input": "Utw√≥rz ticket dla incydentu sieci", "meta": {"user": "alice"}}'
```

- Response: JSON z outputem, trace_id, used_tools.
- Demo queries: `./scripts/demo_queries.sh`.

### Wczytywanie dokument√≥w do RAG

- Wspierane formaty: .md, .txt (rozszerzalne o PDF/HTML).
- Uruchom: `make ingest` (≈∫r√≥d≈Ço: `./docs`).

### Portal administracyjny

- Dostƒôpny na `http://localhost:3000`.
- Funkcje: Health check API, przyk≈Çadowe curl do agent√≥w.
- Rozszerz o fetch audyt√≥w: Dodaj endpoint `/v1/audits` w API.

### Narzƒôdzia i integracje

- Rejestr tooli: `registry.py` ‚Äì dodaj nowe via `register(name, async_fn)`.
- Przyk≈Çady: create_ticket (proxy do Java), get_metrics (stub Prometheus), restart_service (z RBAC).

## Wdro≈ºenie

### Kubernetes (Helm)

1. Zbuduj i push obrazy (u≈ºyj CI).
2. Zainstaluj chart:

   ```sh
   helm upgrade --install astradesk deploy/chart -f deploy/chart/values.yaml \
     --set image.tag=0.2.1 \
     --set autoscaling.enabled=true
   ```

   - HPA: Skaluje na CPU >60%.

### OpenShift

1. Procesuj template:

   ```sh
   oc process -f deploy/openshift/astradesk-template.yaml -p TAG=0.2.1 | oc apply -f -
   ```

### AWS (Terraform)

1. Inicjuj:

   ```sh
   cd infra
   terraform init
   terraform apply -var="region=us-east-1" -var="project=astradesk"
   ```

   - Tworzy: VPC, EKS, RDS (Postgres/MySQL), S3.

### Narzƒôdzia zarzƒÖdzania konfiguracjƒÖ

- **Ansible**: `ansible-playbook -i ansible/inventories/dev/hosts.ini ansible/roles/astradesk_docker/main.yml`.
- **Puppet**: `puppet apply puppet/manifests/astradesk.pp`.
- **Salt**: `salt '*' state.apply astradesk`.

### mTLS i siatka us≈Çug Istio

1. Utw√≥rz namespace: `kubectl apply -f deploy/istio/00-namespace.yaml`.
2. W≈ÇƒÖcz mTLS: `kubectl apply -f deploy/istio/10-peer-authentication.yaml` (i resztƒô plik√≥w z deploy/istio/).
3. Gateway: HTTPS na port 443 z cert-manager.

## CI/CD

### Jenkins

- Uruchom pipeline: `Jenkinsfile` buduje/testuje/pushuje obrazy, deployuje Helm.

### GitLab CI

- `.gitlab-ci.yml`: Etapy build/test/docker/deploy (manual).

## Monitorowanie i obserwowalno≈õƒá

### OpenTelemetry

- Wbudowane w FastAPI (instrumentation).
- Eksport: Do OTLP (Prometheus/Grafana).

### Pulpity i alerty Grafany

- Dashboard: `grafana/dashboard-astradesk.json` (latency, DB calls).
- Alerty: `grafana/alerts.yaml` (high latency, errors) ‚Äì za≈Çaduj do Prometheus.

<br>

## Przewodnik dla deweloper√≥w

Ta sekcja zawiera praktyczne instrukcje i odpowiedzi na najczƒôstsze pytania, kt√≥re pomogƒÖ Ci szybko rozpoczƒÖƒá pracƒô z projektem.

### 1. Podstawowa Konfiguracja ≈örodowiska

Zanim zaczniesz, upewnij siƒô, ≈ºe masz:
- **Docker** i **Docker Compose** (rekomendowany Docker Desktop).
- **Git**, **make** oraz **Node.js** (v22+) zainstalowane lokalnie.

Kroki przygotowawcze (wykonaj je tylko raz):

1.  **Sklonuj repozytorium**:
    ```bash
    git clone https://github.com/your-org/astradesk.git
    cd astradesk
    ```
2.  **Skopiuj plik konfiguracyjny**:
    ```bash
    cp .env.example .env
    ```
3.  **Wygeneruj `package-lock.json`**: Jest to wymagane do budowy obrazu Docker dla portalu admina.
    ```bash
    cd services/admin-portal && npm install && cd ../..
    ```

### 2. Jak Uruchomiƒá Aplikacjƒô?

Masz do wyboru dwa tryby pracy, w zale≈ºno≈õci od Twoich potrzeb.

#### **Tryb A: Pe≈Çne ≈örodowisko Docker (Zalecane)**

Uruchamia **ca≈ÇƒÖ aplikacjƒô** (wszystkie mikroserwisy) w kontenerach Docker. Idealne do test√≥w integracyjnych i symulacji ≈õrodowiska produkcyjnego.

- **Jak uruchomiƒá?**
  ```bash
  make up
  ```
  *(Alternatywnie: `docker compose up --build -d`)*

- **Jak zatrzymaƒá i wyczy≈õciƒá?**
  ```bash
  make down
  ```
  *(Alternatywnie: `docker compose down -v`)*

- **Dostƒôpne serwisy**:
  - **API Gateway**: `http://localhost:8080`
  - **Admin Portal**: `http://localhost:3000`
  - **Ticket Adapter**: `http://localhost:8081`

<br>

#### **Tryb B: Development Hybrydowy (do pracy nad Pythonem)**

Uruchamia **tylko zewnƒôtrzne zale≈ºno≈õci** (bazy danych, NATS, etc.) w Dockerze, a g≈Ç√≥wny **serwer API w Pythonie dzia≈Ça lokalnie**. Idealne do szybkiego developmentu i debugowania kodu Pythona z natychmiastowym prze≈Çadowaniem.

1.  **Krok 1: Uruchom zale≈ºno≈õci w Dockerze** (w jednym terminalu):
    ```bash
    make up-deps
    ```
    *(Alternatywnie: `docker compose up -d db mysql redis nats ticket-adapter`)*

2.  **Krok 2: Uruchom serwer API lokalnie** (w drugim terminalu):
    ```bash
    make run-local
    ```
    *(Alternatywnie: `python -m uvicorn src.gateway.main:app --host 0.0.0.0 --port 8080 --reload --app-dir src`)*

### 3. Jak Testowaƒá?

`Makefile` dostarcza proste komendy do uruchamiania test√≥w.

- **Jak uruchomiƒá wszystkie testy?**
  ```bash
  make test-all
  ```
- **Jak uruchomiƒá tylko testy dla Pythona?**
  ```bash
  make test
  ```
- **Jak uruchomiƒá tylko testy dla Javy?**
  ```bash
  make test-java
  ```
- **Jak uruchomiƒá tylko testy dla Admin Portalu?**
  ```bash
  make test-admin
  ```

### 4. Jak Pracowaƒá z BazƒÖ Danych i RAG?

- **Jak zainicjowaƒá bazƒô danych (stworzyƒá rozszerzenie `pgvector`)?**
  *Uwaga: Je≈õli u≈ºywasz `docker-compose.deps.yml`, ten krok nie jest potrzebny.*
  ```bash
  make migrate
  ```

- **Jak zasiliƒá bazƒô wiedzy RAG?**

  1.  Dodaj swoje pliki `.md` lub `.txt` do katalogu `docs/`.

  2.  Uruchom komendƒô:
      ```bash
      make ingest
      ```

### 5. Jak Sprawdziƒá Dzia≈Çanie Agent√≥w?

Po uruchomieniu aplikacji (w dowolnym trybie), mo≈ºesz wysy≈Çaƒá zapytania do API za pomocƒÖ `curl`.

*Uwaga: Poni≈ºsze przyk≈Çady zak≈ÇadajƒÖ, ≈ºe autoryzacja (`auth_guard` w `main.py`) jest tymczasowo wy≈ÇƒÖczona na potrzeby test√≥w.*

- **Test narzƒôdzia `create_ticket`**:
  ```bash
  curl -X POST http://localhost:8080/v1/agents/run \
    -H "Content-Type: application/json" \
    -d '{"agent": "support", "input": "M√≥j internet nie dzia≈Ça, proszƒô utworzyƒá zg≈Çoszenie."}'
  ```
- **Test narzƒôdzia `get_metrics`**:
  ```bash
  curl -X POST http://localhost:8080/v1/agents/run \
    -H "Content-Type: application/json" \
    -d '{"agent": "ops", "input": "Poka≈º mi metryki dla us≈Çugi webapp"}'
  ```
- **Test RAG (baza wiedzy)**:
  ```bash
  curl -X POST http://localhost:8080/v1/agents/run \
    -H "Content-Type: application/json" \
    -d '{"agent": "support", "input": "Jak mogƒô zresetowaƒá has≈Ço?"}'
  ```

### 6. FAQ - Typowe Problemy i Pytania

- **P: Dostajƒô b≈ÇƒÖd `Connection refused` podczas startu aplikacji.**
  - **O:** Najprawdopodobniej pr√≥bujesz uruchomiƒá serwer API (`make run-local`) zanim kontenery z zale≈ºno≈õciami (`make up-deps`) w pe≈Çni wystartowa≈Çy. Upewnij siƒô, ≈ºe komenda `docker ps` pokazuje status `(healthy)` dla kontener√≥w `db`, `mysql` i `redis` zanim uruchomisz Pythona.

- **P: Dostajƒô b≈ÇƒÖd `{"detail":"Brak nag≈Ç√≥wka autoryzacyjnego Bearer."}`.**
  - **O:** To znaczy, ≈ºe `auth_guard` w `src/gateway/main.py` jest w≈ÇƒÖczony. Do test√≥w lokalnych, zakomentuj liniƒô `claims: dict[str, Any] = Depends(auth_guard),` w definicji endpointu `run_agent` i przeka≈º pusty s≈Çownik `{}` jako `claims` do `orchestrator.run`.

- **P: Jak mogƒô zobaczyƒá logi konkretnego serwisu?**
  - **O:** U≈ºyj komendy `docker logs`. Na przyk≈Çad, aby zobaczyƒá logi `Auditora` na ≈ºywo:
    ```bash
    docker logs -f astradesk-auditor-1
    ```
    *(Nazwa kontenera mo≈ºe siƒô nieznacznie r√≥≈ºniƒá - sprawd≈∫ jƒÖ za pomocƒÖ `docker ps`)*.

- **P: Jak mogƒô przebudowaƒá tylko jeden obraz Docker?**
  - **O:** U≈ºyj flagi `--build` z nazwƒÖ serwisu:
    ```bash
    docker compose up -d --build api
    ```

- **P: Gdzie mogƒô zmieniƒá s≈Çowa kluczowe dla `KeywordPlanner`?**
  - **O:** W pliku `src/runtime/planner.py`, wewnƒÖtrz konstruktora `__init__` klasy `KeywordPlanner`.

<br>

## Testowanie

- Uruchom: `make test` (Python), `make test-java`, `make test-admin`.
- Pokrycie: Unit (pytest, JUnit, Vitest), integracyjne (API flow).

## Bezpiecze≈Ñstwo

- **Auth**: OIDC/JWT z JWKS.
- **RBAC**: Per tool, na bazie claims.
- **mTLS**: STRICT via Istio.
- **Audyt**: W Postgres + NATS publish.
- **Polityki**: Allow-lists w toolach, retries w proxy.

## Mapa drogowa

- Integracja LLM (Bedrock/OpenAI/vLLM) z guardrails.
- Temporal dla d≈Çugotrwa≈Çych workflow√≥w.
- Ewaluacje RAG (Ragas).
- Multi-tenancy i RBAC advanced (OPA).
- Pe≈Çne dashboardy Grafana z alertami.

## Wk≈Çad

- Fork repo, stw√≥rz branch, PR z testami.
- U≈ºyj `make lint/type` przed commit.

## Licencja

Apache License 2.0. See [LICENSE](LICENSE) for details.

## Kontakt

üåê Web site:[ AstraDesk](https://astradesk.vercel.app/)

üìß Autor: Siergej Sobolewski (s.sobolewski@hotmail.com).  

üí¨ Kana≈Çy wsparcia: [Support Slack](https://astradesk.slack.com)

üêô Issues: [GitHub Issues](https://github.com/SSobol77/astradesk/issues).  

<br>

---
*Ostatnia aktualizacja: 2025-10-10*